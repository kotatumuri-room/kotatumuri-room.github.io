<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="jp"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://kotatumuri-room.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://kotatumuri-room.github.io/" rel="alternate" type="text/html" hreflang="jp"/><updated>2025-03-08T06:08:32+00:00</updated><id>https://kotatumuri-room.github.io/feed.xml</id><title type="html">Kotatumuri’s website</title><subtitle>ookina shame desu. </subtitle><entry><title type="html">SettingUpNvidiaSmi</title><link href="https://kotatumuri-room.github.io/blog/2025/SettingUpNvidiaSmi/" rel="alternate" type="text/html" title="SettingUpNvidiaSmi"/><published>2025-03-08T00:00:00+00:00</published><updated>2025-03-08T00:00:00+00:00</updated><id>https://kotatumuri-room.github.io/blog/2025/SettingUpNvidiaSmi</id><content type="html" xml:base="https://kotatumuri-room.github.io/blog/2025/SettingUpNvidiaSmi/"><![CDATA[<h1 id="状況">状況</h1> <p>Ubuntu 24.04LTS をインストールした自作PCのUbuntuアップデートをしたら、nvidia-driverが認識しなくなった。 画像出力可能なハードは２つある（内蔵グラフィックとGPU）。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ lspci | grep VGA
00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-S UHD Graphics (rev 04)
01:00.0 VGA compatible controller: NVIDIA Corporation AD106 [GeForce RTX 4060 Ti] (rev a1)
</code></pre></div></div> <p>ここでは、Intelの内蔵グラフィックで普段の描画はしつつ、GPUは数値計算用に使いたい。</p> <h1 id="発生した症状">発生した症状</h1> <p>Ubuntu アップデートを行ったあとに<code class="language-plaintext highlighter-rouge">nvidia-smi</code>を叩くと、</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nvidia-smi
No devices were found
</code></pre></div></div> <p>となった。<a href="https://qiita.com/y-vectorfield/items/72bfb66d8ec85847fe2f">調べてみた</a>ところ、ドライバーの再インストールをしろと言われたので</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ubuntu-drivers devices |grep nvidia
</code></pre></div></div> <p>でrecomendされていた<code class="language-plaintext highlighter-rouge">nvidia-driver-560</code>をaptインストールした。すると、</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nvidia-smi
NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.
</code></pre></div></div> <p>と出力された。</p> <h1 id="原因">原因</h1> <p>原因はどうやらnvidia-driverがそもそも起動していなかったぽい。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo modprobe nvidia

modprobe: ERROR: ../libkmod/libkmod-module.c:968 kmod_module_insert_module() could not find module by name='off'

modprobe: ERROR: could not insert 'off': Unknown symbol in module, or unknown parameter (see dmesg)
</code></pre></div></div> <p><a href="https://bugs.launchpad.net/ubuntu/+source/nvidia-graphics-drivers-390/+bug/1774359">調べてみる</a>と、prime-selectされていないのが原因ぽく、</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo prime-select nvidia
</code></pre></div></div> <p>とすることで解決自体はした。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nvidia-smi
Sat Mar  8 13:51:59 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 560.35.03              Driver Version: 560.35.03      CUDA Version: 12.6     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce RTX 4060 Ti     Off |   00000000:01:00.0 Off |                  N/A |
|  0%   25C    P8              2W /  165W |       7MiB /  16380MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+

</code></pre></div></div> <h1 id="内蔵グラフィックつかえていないんじゃないか問題">内蔵グラフィックつかえていないんじゃないか問題</h1> <p>でもそもそもこの解決策では内蔵グラフィックで描画できていないんじゃないかという気持ちがある。これに関しては現時点ではよくわかっていないが、すくなくとも<code class="language-plaintext highlighter-rouge">nvidia-smi</code>の出力を見るとなにもプロセスが走っていないことがわかるので、一旦これでいいことにしようというきもちになっている(もしかしたら、<code class="language-plaintext highlighter-rouge">prime-select intel</code>と<code class="language-plaintext highlighter-rouge">prime-select nvidia</code>を交互に叩いているうちになんとかなったのかもしれない)。</p>]]></content><author><name></name></author><category term="pc-info"/><category term="ubuntu"/><category term="cuda"/><category term="pc-setup"/><summary type="html"><![CDATA[Ubuntu updateをするとなんかnvidia-smiが叩けなくなったときの備忘録]]></summary></entry><entry><title type="html">HelloWorld!</title><link href="https://kotatumuri-room.github.io/blog/2023/HelloWorld!/" rel="alternate" type="text/html" title="HelloWorld!"/><published>2023-12-03T00:00:00+00:00</published><updated>2023-12-03T00:00:00+00:00</updated><id>https://kotatumuri-room.github.io/blog/2023/HelloWorld!</id><content type="html" xml:base="https://kotatumuri-room.github.io/blog/2023/HelloWorld!/"><![CDATA[<h1 id="hello-world">Hello World!!!</h1> <p>世界がこんにちはしています。かわいいね。</p>]]></content><author><name></name></author><category term="test"/><category term="helloworld"/><summary type="html"><![CDATA[世界にこんにちは]]></summary></entry></feed>